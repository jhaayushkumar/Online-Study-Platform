name: Code Quality

on:
  pull_request:
    branches: [ main, develop ]

jobs:
  code-quality:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
    
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'
    
    - name: Check for console.log in frontend
      run: |
        if grep -r "console\.log" frontend/src --include="*.jsx" --include="*.js" | grep -v "// console.log"; then
          echo "Warning: console.log statements found in frontend code"
          echo "Consider removing them before merging to production"
        else
          echo "No console.log statements found"
        fi
      continue-on-error: true
    
    - name: Check for TODO comments
      run: |
        TODO_COUNT=$(grep -r "TODO\|FIXME\|HACK" --include="*.js" --include="*.jsx" . | wc -l)
        echo "TODO/FIXME comments found: $TODO_COUNT"
        if [ $TODO_COUNT -gt 0 ]; then
          echo "### TODO Comments" >> $GITHUB_STEP_SUMMARY
          grep -rn "TODO\|FIXME\|HACK" --include="*.js" --include="*.jsx" . | head -20 >> $GITHUB_STEP_SUMMARY || true
        fi
      continue-on-error: true
    
    - name: Check package.json for vulnerabilities
      run: |
        cd frontend && npm audit --audit-level=high || echo "Vulnerabilities found in frontend"
        cd ../backend && npm audit --audit-level=high || echo "Vulnerabilities found in backend"
      continue-on-error: true
    
    - name: Code Quality Summary
      run: |
        echo "### Code Quality Check Complete" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "Review the warnings above and address them if needed." >> $GITHUB_STEP_SUMMARY
